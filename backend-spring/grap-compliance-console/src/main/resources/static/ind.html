<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GRAP Compliance Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 40px;
    }

    h1 {
      margin-bottom: 10px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .card {
      background: #111827;
      border: 1px solid #1f2933;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 10px;
      font-size: 14px;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 6px;
    }

    button {
      margin-top: 12px;
      padding: 10px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button.secondary {
      background: #475569;
    }

    button.danger {
      background: #dc2626;
    }

    pre {
      background: #020617;
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
      margin-top: 10px;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>GRAP Compliance Console</h1>
  <p>GDPR Cryptographic Deletion & Legal Hold Prototype</p>

  <!-- Ping -->
  <div class="card">
    <button onclick="ping()">Ping API</button>
    <pre id="pingOut"></pre>
  </div>

  <!-- Create User -->
  <div class="card">
    <h3>Create User</h3>
    <label>Full Name</label>
    <input id="fullName" />

    <label>Email</label>
    <input id="email" />

    <label>Phone</label>
    <input id="phone" />

    <button onclick="createUser()">Create User</button>
    <pre id="createUserOut"></pre>
  </div>

  <div class="row">

    <!-- Create Backup -->
    <div class="card">
      <h3>Create Backup</h3>
      <label>Backup Type</label>
      <input id="backupType" value="daily" />

      <label>
        <input type="checkbox" id="protectedByHold" checked />
        Protected by Legal Hold
      </label>

      <button onclick="createBackup()">Create Backup</button>
      <pre id="backupOut"></pre>
    </div>

    <!-- Index User -->
    <div class="card">
      <h3>Index User into Backup</h3>
      <label>Backup ID</label>
      <input id="backupId" />

      <label>User ID</label>
      <input id="backupUserId" />

      <button onclick="indexUser()">Index User</button>
      <pre id="indexOut"></pre>
    </div>

  </div>

  <!-- Destroy Keys -->
  <div class="card">
    <h3>Destroy User Keys</h3>
    <label>User ID</label>
    <input id="destroyUserId" />

    <button class="danger" onclick="destroyKeys()">Destroy Keys</button>
    <pre id="destroyOut"></pre>
  </div>

  <!-- Restore -->
  <div class="card">
    <h3>Restore Users from Shadow</h3>
    <button class="secondary" onclick="restore()">Restore Users</button>
    <pre id="restoreOut"></pre>
  </div>

</div>

<script>
  const api = path => fetch(path).then(r => r.json());

  async function ping() {
    const r = await api("/api/ping");
    pingOut.textContent = JSON.stringify(r, null, 2);
  }

  async function createUser() {
    const body = {
      full_name: fullName.value,
      email: email.value,
      phone: phone.value
    };

    const r = await fetch("/api/users", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(body)
    }).then(r => r.json());

    createUserOut.textContent = JSON.stringify(r, null, 2);
  }

  async function createBackup() {
    const body = {
      backup_type: backupType.value,
      protected_by_hold: protectedByHold.checked
    };

    const r = await fetch("/api/admin/backups", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(body)
    }).then(r => r.json());

    backupOut.textContent = JSON.stringify(r, null, 2);
  }

  async function indexUser() {
    const r = await fetch(`/api/admin/backups/${backupId.value}/users`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ user_id: backupUserId.value })
    }).then(r => r.json());

    indexOut.textContent = JSON.stringify(r, null, 2);
  }

  async function destroyKeys() {
    const r = await fetch(`/api/users/${destroyUserId.value}/destroy-keys`, {
      method: "POST"
    }).then(r => r.json());

    destroyOut.textContent = JSON.stringify(r, null, 2);
  }

  async function restore() {
    const r = await fetch("/api/admin/restore-users", {
      method: "POST"
    }).then(r => r.json());

    restoreOut.textContent = JSON.stringify(r, null, 2);
  }
</script>

</body>
</html>
